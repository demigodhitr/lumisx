{% load humanize %}
{% load static %}
<!doctype html>
<html lang="en">

<head>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script>
        function expiredCallback() {
            alert('Captcha response timeout expired. please try again!');
        }
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Contact us | LLumistakes</title>
    <meta name="description"
        content="Lumistakes is a trading platform that offers online trading of complex derivative cryptocurrencies with leverage and copy trading. Log in to your personal area to access your accounts, deposit or withdraw funds, and claim bonuses.">
    <meta name="keywords"
        content="Crypto, Cryptocurrency, best cryptocurrency, best performing crypto, best exchange 2025, worldwide trading, investments, how to invest safely, how to invest, how to invest online, how to invest, 2025, best cryptocurrency, how to withdraw crypto, buy crypto, sell crypto, convert crypto" />
    <meta name="author" content="Lumistakes" />
    <link rel="icon" type="image/png" href="{% static 'assets/img/favicon.png' %}" sizes="32x3">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'assets/img/icon/192x192.png' %}">
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
    <link rel="manifest" href="{% static '__manifest.json' %}">

    <style>
        .is-invalid {
            border-color: #dc3545;
        }

        .is-invalid:focus {
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }

    </style>
</head>

<body>

    <!-- loader -->
    <div id="loader">
        <img src="{% static 'assets/img/loading-icon.png' %}" alt="icon" class="loading-icon">
    </div>
    <!-- * loader -->

    <!-- App Header -->
    <div class="appHeader">
        <div class="left">
            <a href="#" class="headerButton goBack">
                <ion-icon name="chevron-back-outline"></ion-icon>
            </a>
        </div>
        <div class="pageTitle">
            Contact Support - Lumistakes 
        </div>
        <div class="right">
            <a href="#" class="headerButton">
                <ion-icon name="call-outline"></ion-icon>
            </a>
        </div>
    </div>
    <!-- * App Header -->

    <!-- App Capsule -->
    <div id="appCapsule">

        <div class="section mt-2">
            <div class="card">
                <div class="card-body">
                    <div class="p-1">
                        <div class="text-center">
                            <h2 class="text-primary">Get in Touch</h2>
                            <p>Fill the form to contact us</p>
                        </div>
                        <form method="post" id="contactForm">
                            <div class="form-group basic animated">
                                <div class="input-wrapper">
                                    <label class="label" for="name2">Your name</label>
                                    <input name="full_name" value="{{user.get_full_name}}" type="text" class="form-control" id="name2" placeholder="Your name">
                                    <i class="clear-input">
                                        <ion-icon name="close-circle"></ion-icon>
                                    </i>
                                </div>
                            </div>
                            <div class="form-group basic animated">
                                <div class="input-wrapper">
                                    <label class="label" for="email2">E-mail</label>
                                    <input name="email" type="email" value="{{user.email}}" class="form-control" id="email2" placeholder="E-mail">
                                    <i class="clear-input">
                                        <ion-icon name="close-circle"></ion-icon>
                                    </i>
                                </div>
                            </div>
                            <div class="form-group basic animated">
                                <div class="input-wrapper">
                                    <label class="label" for="message">Message</label>
                                    <textarea name="message" id="message" rows="4" class="form-control"
                                        placeholder="Message"></textarea>
                                    <i class="clear-input">
                                        <ion-icon name="close-circle"></ion-icon>
                                    </i>
                                </div>
                            </div>
                            <div class="my-4 col-12">
                                <div data-expired-callback="expiredCallback" class="g-recaptcha" data-type="checkbox" data-sitekey="6LdLciYrAAAAAO4Sv9Ol_uIgE-moLohS5lzBOFwV"></div>
                            </div>
                            <div class="alert " role="alert" id="feedback">

                            </div>

                            <div class="mt-2">
                                <button type="submit" class="btn btn-primary btn-lg btn-block">Send</button>
                            </div>

                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="section mt-2">
            <div class="card">
                <div class="card-body">
                    <div class="p-1">
                        <div class="text-center">
                            <h2 class="text-primary">Our Address</h2>
                            <p class="card-text">
                                3rd Floor, Unit 0F U35A, Glagow G! 4BW, United Kingdom
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section mt-2 mb-2">
            <div class="card">
                <div class="card-body">
                    <div class="p-1">
                        <div class="text-center">
                            <h2 class="text-primary mb-2">Live chat channels</h2>

                            <a href="#" onclick="smartsupp('chat:open'); return false;" class="btn btn-whatsapp btn-icon me-05">
                                <ion-icon name="logo-wechat"></ion-icon>
                            </a>

                            <!-- <a href="#" class="btn btn-instagram btn-icon me-05">
                                <ion-icon name="logo-instagram"></ion-icon>
                            </a>

                            <a href="#" class="btn btn-twitch btn-icon me-05">
                                <ion-icon name="logo-twitch"></ion-icon>
                            </a> -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- * App Capsule -->


    <!-- App Bottom Menu -->
        <div class="appBottomMenu" style="position: fixed; z-index: 1; bottom: 0;">  
            <a href="{% url 'home' %}" class="item ">
                <div class="col">
                    <ion-icon name="pie-chart-outline"></ion-icon>
                    <strong>Overview</strong>
                </div>
            </a>
            <a href="{% url 'cards' %}" class="item ">
                <div class="col">
                    <ion-icon name="card-outline"></ion-icon>
                    <strong>My Cards</strong>
                </div>
            </a>
            <a href="{% url 'menu' %}" class="item">
                <div class="col">
                    <div class="action-button">
                        <ion-icon name="home"></ion-icon>
                    </div>
                </div>
            </a>
            <a href="{% url 'transactions' %}" class="item">
                <div class="col">
                    <ion-icon name="document-text-outline"></ion-icon>
                    <strong>History</strong>
                </div>
            </a>
            <a href="{% url 'settings' %}" class="item">
                <div class="col">
                    <ion-icon name="person-outline"></ion-icon>
                    <strong>Me</strong>
                </div>
            </a>
        </div>
    <!-- * App Bottom Menu -->


    <!-- ========= JS Files =========  -->
    <!-- Bootstrap -->
    <script src="{% static 'assets/js/lib/bootstrap.bundle.min.js' %}"></script>
    <!-- Ionicons -->
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
    <!-- Splide -->
    <script src="{% static 'assets/js/plugins/splide/splide.min.js' %}"></script>
    <!-- Base Js File -->
    <script src="{% static 'assets/js/base.js' %}"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {

            function getCookie(name){
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        // Check if this cookie string begins with the name we want
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue
            }
            const csrftoken = getCookie('csrftoken');

            const form = document.getElementById('contactForm');
            const feedbackElement = document.getElementById('feedback'); 
            form.addEventListener('submit', async function (e){
                e.preventDefault();
                const elements = form.elements;

                for (let i = 0; i < elements.length; i++){
                    const element = elements[i];
                    if (element.type !== 'submit' && element.value === ''){
                        if (element.name === 'g-recaptcha-response') {
                            feedbackElement.classList.remove('alert-info');
                            feedbackElement.classList.add('alert-danger');
                        	feedbackElement.innerHTML = 'Please solve the captcha challenge';
                            return;
						}
                        element.classList.add('is-invalid');
                        element.focus();
                        feedbackElement.innerHTML = "Please enter all required fields";
                        feedbackElement.classList.add('alert-danger');
                        return;
                    } else {
                        element.classList.remove('is-invalid');
                        feedbackElement.classList.remove('alert-danger');
                        feedbackElement.innerHTML = "";
                    }
                }
            
                const name = elements['full_name'].value;
                const email = elements['email'].value;
                const message = elements['message'].value;
                const captcha = elements['g-recaptcha-response'].value;

                if (name.length < 5){
                    feedbackElement.innerHTML = "Please enter a valid name";
                    feedbackElement.classList.remove('alert-info');
                    feedbackElement.classList.add('alert-danger');
                    return;
                }

                if (message.length < 25){
                    feedbackElement.innerHTML = "Please enter more details about your inquiry";
                    feedbackElement.classList.remove('alert-info');
                    feedbackElement.classList.add('alert-danger');
                    return;
                }
                feedbackElement.innerHTML = "Sending...";
                feedbackElement.classList.remove('alert-danger');
                feedbackElement.classList.add('alert-info');

                try{
                    const formData = new FormData(this);
                    const url = "{% url 'contact' %}";
                    const sendMessage = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': csrftoken
                        },
                        body: formData
                    });
                    const result = await sendMessage.json();
                    if (result.success){
                        feedbackElement.innerHTML = result.success;
                        feedbackElement.classList.remove('alert-danger');
                        feedbackElement.classList.add('alert-success');
                        form.reset();
                    } else {
                        feedbackElement.innerHTML = result.error;
                        feedbackElement.classList.remove('alert-info');
                        feedbackElement.classList.add('alert-danger');
                    }
                } catch (error){
                    console.error('Error:', error);
                    feedbackElement.innerHTML = "An error occurred. Please try again.";
                    feedbackElement.classList.remove('alert-info');
                    feedbackElement.classList.remove('alert-success');
                    feedbackElement.classList.add('alert-danger');
                }

            })
            // Your code here
        })
    </script>

    <!-- Smartsupp Live Chat script -->
    <script type="text/javascript">
    var _smartsupp = _smartsupp || {};
    _smartsupp.key = 'e17750997929708d3395fda6238ef42a92e0a1b2';
    _smartsupp.hideWidget = true;
    _smartsupp.ratingEnabled = true;
    window.smartsupp||(function(d) {
    var s,c,o=smartsupp=function(){ o._.push(arguments)};o._=[];
    s=d.getElementsByTagName('script')[0];c=d.createElement('script');
    c.type='text/javascript';c.charset='utf-8';c.async=true;
    c.src='https://www.smartsuppchat.com/loader.js?';s.parentNode.insertBefore(c,s);
    })(document);

    smartsupp('name', '{{user.get_full_name}}');
    smartsupp('email', '{{user.email}}');

    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            smartsupp('chat:hide');
        });
    </script>

</body>

</html>